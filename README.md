# Aviasales task: Java
Сервис развернут на Heroku. 
Для получения информации о перелете нужно сделать запрос вида GET `https://aviasales-task-java.herokuapp.com/flights/:id`

Например, https://aviasales-task-java.herokuapp.com/flights/3 

Используется бесплатный план Heroku, поэтому сервис иногда засыпает и нужно подождать, пока он проснется.
## Локальный запуск

### Docker
Для старта потребуется Docker. 

Собираем образ:

`docker build -t app .` 

Запускаем контейнер:

`docker run -p 8080:8080 app`

### Maven
Альтернативный вариант запуска через Maven:

Windows:
`mvnw.cmd spring-boot:run`

Linux:
`./mvnw spring-boot:run`

Переменная среды `JAVA_HOME` должна указывать на 11 версию Java.

## Использование

Сделать GET-запрос на `http://localhost:8080/flights/:id`

## Решение
Источником данных является csv файл, который в теории может быть 
достаточно большим. Так как файл поддерживает только последовательное чтение,
доступ к информации о конкретном перелете может занимать много времени 
и зависит от расположения перелета в файле. 
Для решения этой проблемы содержимое файла загружается в in-memory 
базу данных H2 с индексом по полю id.

На машине должно быть достаточное количество памяти для загружаемых данных.

### Возможная оптимизация

Зная особенности данных и контекст их использования, можно было бы сократить 
количество занимаемой памяти и сохранять в базе данных только 
те данные, которые запрашиваются пользователями чаще всего. Например, 
если мы знаем, что наиболее часто запрашиваются о перелетах за ближайшие 
3 месяца, то сохранить в базу данных можно только их. Информация об остальных 
перелетах будет последовательно читаться из файла.
В этом случае в базе данных также следует хранить идентификаторы всех
существующих перелетов. В этом случае не придется читать весь csv файл
при запросе несуществующего перелета. 

### Преимущества решения
Хранение информации о перелетах в csv файле в любом случае выглядит
не оптимально. Данное решение позволяет изменять способ хранения
данных без значительных изменений в коде. Во время работы приложения
в качестве источника уже используется база данных, но только в качестве
временного хранилища. Чтобы начать использовать полноценную базу данных, 
например PostgreSQL, потребуется лишь небольшое изменение в конфигурации 
приложения. 

При изменении формата хранения данных в файле, например с csv на json,
потребуется только небольшое изменение логики чтения из файла. 
Схема базы данных и контракт сервиса при этом не изменится.

### Структура проекта
Код расположен в пакете `aviasales.task`:

- controller - Rest API контроллеры, содержит логику формирования ответов сервиса и обработки ошибок
- service - слой бизнес-логики
- model - представление данных внутри приложения
- repository - Spring Data JPA репозитории, необходимые для работы с базой данных
- configuration - конфигурация приложения
- exception - описание классов ошибок

Бизнес-логика покрыта unit-тестами.

### Стек технологий
- Java 11
- Spring Framework (Boot, Data JPA)
- H2 database
- Apache Commons
- Lombok
- JUnit, Mockito
- Docker
- Heroku

